(function(b){if(!b.metadatas){b.metadatas={};}var d=b.metadatas;d.getFileURL=function(f,e,g){if(!mydmam.metadatas.url.metadatafile){return"";
}return mydmam.metadatas.url.metadatafile.replace("filehashparam1",f).replace("typeparam2",e).replace("fileparam3",g);
};d.ImageURL=function(e,f){if(f==null){return null;}return d.getFileURL(e,f.type,f.file);
};var c=function(f,e){if(e==null){e="full_size_thumbnail";}if(e==="full_size_thumbnail"){if(f.full_size_thumbnail){return f.full_size_thumbnail;
}else{e="cartridge_thumbnail";}}if(e==="cartridge_thumbnail"){if(f.cartridge_thumbnail){return f.cartridge_thumbnail;
}else{e="icon_thumbnail";}}if(e==="icon_thumbnail"){if(f.icon_thumbnail){return f.icon_thumbnail;
}}return null;};d.chooseTheCorrectImageURL=function(f,g,e){return d.ImageURL(f,c(g,e));
};d.Image=React.createClass({displayName:"Image",render:function(){var h=this.props.file_hash;
var j=this.props.previews;var g=this.props.prefered_size;var l=c(j,g);if(l===null){return null;
}var f=d.ImageURL(h,l);var i=l.options.width;var e=l.options.height;var k=null;if((i>0)&(e>0)){k=(React.createElement("img",{src:f,className:"img-polaroid",alt:i+"x"+e,style:{width:i,height:e}}));
}else{k=(React.createElement("img",{src:f,className:"img-polaroid"}));}return(React.createElement("div",{style:{marginBottom:"1em"}},React.createElement(d.AudioGraphicDeepAnalyst,{previews:j,file_hash:h}),k));
}});var a=React.createClass({displayName:"QualityTabs",handleClickSwitchSize:function(e){e.preventDefault();
this.props.onSwitchSize(!this.props.isbigsize);},handleClickSwitchQuality:function(e){e.preventDefault();
this.props.onChangeQuality($(e.currentTarget).data("qualid"));},render:function(){var f="icon-resize-full";
if(this.props.isbigsize){f="icon-resize-small";}var e=this.props.medias;var k=this.props.selectedquality;
var g=[];for(var j=0;j<e.length;j++){var h=classNames({active:(j===k)});g.push(React.createElement("li",{key:j,className:h},React.createElement("a",{href:e[j].url,style:{outline:"none"},onClick:this.handleClickSwitchQuality,"data-qualid":j},e[j].label)));
}g.push(React.createElement("li",{key:"switchsize"},React.createElement("a",{href:"",style:{outline:"none"},onClick:this.handleClickSwitchSize},React.createElement("i",{className:f}))));
return(React.createElement("ul",{className:"nav nav-tabs"},g));}});d.Video=React.createClass({displayName:"Video",getInitialState:function(){return{selectedquality:0,medias:[],isbigsize:false,transport:null,currentTime:null,duration:null};
},componentDidMount:function(){var i=this.props.master_as_preview_url;var f=this.props.file_hash;
var g=this.props.mtdsummary.previews;var e=[];if(i){var h={};h.url=i;h.label="Original";
e.push(h);}if(g){if(g.video_hd_pvw){var h={};h.url=d.getFileURL(f,g.video_hd_pvw.type,g.video_hd_pvw.file);
h.label="HD";e.push(h);}if(g.video_sd_pvw){var h={};h.url=d.getFileURL(f,g.video_sd_pvw.type,g.video_sd_pvw.file);
h.label="SQ";e.push(h);}if(g.video_lq_pvw){var h={};h.url=d.getFileURL(f,g.video_lq_pvw.type,g.video_lq_pvw.file);
h.label="LQ";e.push(h);}}this.setState({medias:e});},handleChangeQuality:function(e){this.setState({selectedquality:e,transport:{macro:"RELOAD_PLAY"}});
},handleSwitchSize:function(e){this.setState({isbigsize:e});},transportStatusChange:function(f,g,e){this.setState({currentTime:f,duration:g,transport:null});
},goToNewTime:function(e){this.setState({transport:{gototime:e}});},render:function(){var e=this.props.file_hash;
var k=this.props.mtdsummary.previews;if(this.state.medias.length===0){return null;
}var g=this.state.medias[this.state.selectedquality].url;var n=d.chooseTheCorrectImageURL(e,k);
var i=640;var o=360;var l=null;var f=this.state.isbigsize;if(f){i=null;o=null;l="container";
}var m=null;if(d.hasAudioGraphicDeepAnalyst(k)){m=this.transportStatusChange;}var h=(React.createElement(b.Mediaplayer,{transport:this.state.transport,transport_status:m,className:l,width:i,height:o,poster:n,cantloadingplayerexcuse:i18n("browser.cantloadingplayer"),source_url:g}));
var j=null;if(this.state.medias.length>1){j=(React.createElement("div",{className:"tabbable tabs-below"},React.createElement("div",{className:"tab-content"},h),React.createElement(a,{isbigsize:f,medias:this.state.medias,selectedquality:this.state.selectedquality,onChangeQuality:this.handleChangeQuality,onSwitchSize:this.handleSwitchSize})));
}else{j=h;}return(React.createElement("div",{style:{marginBottom:"1em"}},j,React.createElement(d.AudioGraphicDeepAnalyst,{previews:k,file_hash:e,currentTime:this.state.currentTime,duration:this.state.duration,goToNewTime:this.goToNewTime})));
}});d.Audio=React.createClass({displayName:"Audio",getInitialState:function(){return{currentTime:null,duration:null,transport:null};
},transportStatusChange:function(f,g,e){this.setState({currentTime:f,duration:g,transport:null});
},goToNewTime:function(e){this.setState({transport:{gototime:e}});},render:function(){var h=this.props.file_hash;
var i=this.props.mtdsummary.previews;var f=this.props.mtdsummary.mimetype;var e=this.props.reference;
var j=this.props.master_as_preview_url;var g=null;if(j){g=j;}else{if(i){g=d.getFileURL(h,i.audio_pvw.type,i.audio_pvw.file);
}}if(g==null){return null;}var k=null;if(d.hasAudioGraphicDeepAnalyst(i)){k=this.transportStatusChange;
}return(React.createElement("div",{style:{marginBottom:"1em"}},React.createElement(b.Mediaplayer,{transport:this.state.transport,transport_status:k,audio_only:true,cantloadingplayerexcuse:i18n("browser.cantloadingplayer"),source_url:g}),React.createElement(d.AudioGraphicDeepAnalyst,{previews:i,file_hash:h,currentTime:this.state.currentTime,duration:this.state.duration,goToNewTime:this.goToNewTime}),React.createElement("div",{className:"pull-right"},React.createElement(d.Image,{file_hash:h,previews:i,prefered_size:"cartridge_thumbnail"}))));
}});d.hasAudioGraphicDeepAnalyst=function(e){return !(e.audio_graphic_deepanalyst==null);
};d.AudioGraphicDeepAnalyst=React.createClass({displayName:"AudioGraphicDeepAnalyst",getInitialState:function(){return{last_bar_position:-1};
},clickCanvas:function(l){if(this.props.duration==null|this.props.goToNewTime==null){return;
}if(this.props.duration==0){return;}var h=React.findDOMNode(this.refs.player_cursor);
var k=h.getBoundingClientRect();var g=l.clientX-k.left;var i=this.props.previews.audio_graphic_deepanalyst.options.width;
var j=60;var f=i-(j+12);var e=g-j;if((e>=0)&&(e<=f)){this.props.goToNewTime(this.props.duration*(e/f));
}},componentDidUpdate:function(){if(this.props.duration==null){return;}if(this.props.duration==0){return;
}var k=this.props.currentTime/this.props.duration;var f=this.props.previews.audio_graphic_deepanalyst.options.width;
var p=this.props.previews.audio_graphic_deepanalyst.options.height;var e=60;var j=10;
var i=p-(j+50);var h=f-(e+12);var l=h;var m=Math.floor(l*k)+e;if(this.state.last_bar_position==m){return;
}var g=React.findDOMNode(this.refs.player_cursor);var o=g.width;var n=g.height;var q=g.getContext("2d");
q.fillStyle="#FFFFFF";q.clearRect(0,0,f,p);q.fillRect(m,j,2,i);this.setState({last_bar_position:m});
},render:function(){var h=this.props.previews;if(h.audio_graphic_deepanalyst==null){return null;
}var f=this.props.file_hash;var g=d.getFileURL(f,h.audio_graphic_deepanalyst.type,h.audio_graphic_deepanalyst.file);
var e=h.audio_graphic_deepanalyst.options;var i=(React.createElement("div",{style:{marginTop:"1em",marginBottom:"1em"}},React.createElement(d.AudioStatsDeepAnalyst,{file_hash:f,lufs_ref:e.lufs_ref,truepeak_ref:e.truepeak_ref}),React.createElement("div",null,React.createElement("img",{src:g,alt:e.width+"x"+e.height,style:{width:e.width,height:e.height}}))));
if(this.props.duration==null){return i;}if(this.props.duration==0){return i;}return(React.createElement("div",{style:{marginTop:"1em",marginBottom:"1em"}},React.createElement(d.AudioStatsDeepAnalyst,{goToNewTime:this.props.goToNewTime,file_hash:f,lufs_ref:e.lufs_ref,truepeak_ref:e.truepeak_ref}),React.createElement("div",{style:{width:e.width,height:e.height}},React.createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},React.createElement("img",{src:g,alt:e.width+"x"+e.height,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0}}),";",React.createElement("canvas",{ref:"player_cursor",onClick:this.clickCanvas,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,cursor:"text"},width:e.width,height:e.height})))));
}});d.AudioStatsDeepAnalyst=React.createClass({displayName:"AudioStatsDeepAnalyst",getInitialState:function(){return{analyst_result:null,show_audio_stat_channel:"Overall",show_bottom_panel:false};
},componentWillMount:function(){mydmam.async.request("stat","metadataanalystresults",{pathelementkey:this.props.file_hash,mtype:"ffaudioda"},function(e){this.setState({analyst_result:e});
}.bind(this));},toogleBottomPanel:function(){this.setState({show_bottom_panel:!this.state.show_bottom_panel});
},onChooseAudioStatBlock:function(e){this.setState({show_audio_stat_channel:e});},render:function(){var s=(React.createElement("span",null,"-∞"));
var A=s;var z=s;var h=s;var f=s;var y=s;var v=s;var x=s;var w={color:"#777"};var o={color:"#777"};
var e=null;if(this.state.analyst_result!=null){A=this.state.analyst_result.integrated_loudness;
z=this.state.analyst_result.integrated_loudness_threshold;h=this.state.analyst_result.loudness_range_LRA;
f=this.state.analyst_result.loudness_range_threshold;y=this.state.analyst_result.loudness_range_LRA_low;
v=this.state.analyst_result.loudness_range_LRA_high;x=this.state.analyst_result.true_peak;
if((A-2)>this.props.lufs_ref){w={color:"#F00"};}else{if((A+2)<this.props.lufs_ref){w={color:"#F0F"};
}else{w={color:"#0F0"};}}if(x>this.props.truepeak_ref){o={color:"#F00"};}else{o={color:"#0F0"};
}if(this.state.analyst_result.silences){var p="Silences warn";if(this.state.analyst_result.silences.length==1){p="Silence warn";
}e=(React.createElement("span",{style:{backgroundColor:"#A00",color:"#FAA",fontWeight:"bold",borderRadius:4,marginLeft:"8px",padding:"1px 7px 2px 6px",letterSpacing:"-0.5"}},p));
}}var u="+";var m=null;if(this.state.show_bottom_panel&(this.state.analyst_result!=null)){u="-";
var l=null;if(this.state.analyst_result.silences){var j=this.state.analyst_result.silences;
var n=[];for(var k in j){var g=j[k];if(g.to==0){n.push(React.createElement("tr",{key:k},React.createElement("td",{colSpan:"3"},"Ends by silence from ",React.createElement(d.ButtonSilenceGotoPlay,{timevalue:g.from,onGotoSilence:this.props.goToNewTime}))));
}else{n.push(React.createElement("tr",{key:k},React.createElement("td",null,Math.abs(k)+1),React.createElement("td",{style:{textAlign:"center"}},React.createElement(d.ButtonSilenceGotoPlay,{timevalue:g.from,onGotoSilence:this.props.goToNewTime})),React.createElement("td",{style:{textAlign:"center"}},"→ ",React.createElement(d.ButtonSilenceGotoPlay,{timevalue:g.to,onGotoSilence:this.props.goToNewTime})),React.createElement("td",{style:{textAlign:"center"}},"Δ ",React.createElement(d.ButtonSilenceGotoPlay,{timevalue:g.to-g.from}))));
}}l=(React.createElement("div",{style:{marginBottom:"6px",color:"#bbb"}},React.createElement("em",null,"Detected silences:"),React.createElement("table",{style:{marginLeft:"6px"}},React.createElement("tbody",null,n)),React.createElement("small",null,"Silence detect level threshold: ",React.createElement("strong",null,this.state.analyst_result.silencedetect_level_threshold)," dBFS during ",React.createElement("strong",null,this.state.analyst_result.silencedetect_min_duration)," sec.")));
}var t=[];t.push(React.createElement(d.ButtonChooseAudioStatBlock,{selected:this.state.show_audio_stat_channel=="Overall",key:0,channel:"Overall",onChooseAudioStatBlock:this.onChooseAudioStatBlock}));
for(var k in this.state.analyst_result.channels_stat){var r=k;t.push(React.createElement("span",{key:k+1},React.createElement(d.ButtonChooseAudioStatBlock,{channel:r,selected:this.state.show_audio_stat_channel==r,onChooseAudioStatBlock:this.onChooseAudioStatBlock})));
}var q=null;var i=function(B){var C=""+B.dc_offset.toFixed(6);if(B.dc_offset>=0){C="+"+C;
}return(React.createElement("div",{style:{marginLeft:"6px"}},React.createElement("div",null,"DC Offset: ",React.createElement("strong",{style:{color:"rgb(212, 228, 166)"}},C)),React.createElement("div",null,"Level: min ",React.createElement("strong",{style:{color:"rgb(106, 127, 138)"}},B.min_level),", max ",React.createElement("strong",{style:{color:"rgb(106, 127, 138)"}},B.max_level)),React.createElement("div",null,"Difference: min ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},B.min_difference),", max ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},B.max_difference),", mean ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},B.mean_difference)),React.createElement("div",null,"Peak level: ",React.createElement("strong",{style:{color:"rgb(247, 165, 87)"}},B.peak_level.toFixed(2))," dBFS, count: ",React.createElement("strong",{style:{color:"rgb(247, 165, 87)"}},B.peak_count)),React.createElement("div",null,"RMS (dBFS): level ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},B.rms_level.toFixed(2)),", peak ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},B.rms_peak.toFixed(2)),", trough ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},B.rms_trough.toFixed(2))),React.createElement("div",null,"Crest factor: ",React.createElement("strong",{style:{color:"rgb(78,105,137)"}},B.crest_factor.toFixed(2)),", flat factor: ",React.createElement("strong",{style:{color:"rgb(78,105,137)"}},B.flat_factor.toFixed(2)))));
};if(this.state.show_audio_stat_channel=="Overall"){q=i(this.state.analyst_result.overall_stat);
}else{for(var k in this.state.analyst_result.channels_stat){var r=k;if(this.state.show_audio_stat_channel==r){q=i(this.state.analyst_result.channels_stat[k]);
break;}}}m=(React.createElement("div",{style:{padding:"0px 12px 12px",backgroundColor:"#333",color:"#887",fontFamily:"Tahoma, Arial",width:"300pt"}},l,React.createElement("div",{style:{marginBottom:"6px",marginTop:"0px",paddingTop:"10px"}},t),q,React.createElement("span",{style:{fontWeight:"bold",color:"rgb(92,200,90)"}},this.state.analyst_result.number_of_samples)," samples"));
}return(React.createElement("div",{className:"clearfix",style:{marginBottom:"1em"}},React.createElement("div",{style:{padding:"12px 12px 7px",backgroundColor:"#333",color:"#fff",fontFamily:"Tahoma, Arial",width:"300pt",fontWeight:"bold"}},React.createElement("div",{style:{left:"0px",top:"12px",position:"relative","float":"left",fontSize:"56px"}},React.createElement("span",{style:w},A)),React.createElement("div",{style:{left:"0px",top:"0px",position:"relative","float":"left",fontSize:"16px",color:"#666"}}," LUFS"),React.createElement("div",{style:{left:"18px",top:"22px",position:"relative","float":"left",fontSize:"28px"}},React.createElement("span",{style:o},x)),React.createElement("div",{style:{left:"-30px",top:"0px",position:"relative","float":"left",fontSize:"16px",color:"#666"}}," dB TPK"),React.createElement("div",{style:{left:"-5px",top:"0px",position:"relative","float":"left",lineHeight:"15px",color:"rgb(148, 104, 83)"}},React.createElement("span",{style:{fontWeight:"normal"}},"High"),React.createElement("br",null),React.createElement("span",null,"LRA"),React.createElement("br",null),React.createElement("span",{style:{fontWeight:"normal"}},"Low")),React.createElement("div",{style:{left:"5px",top:"0px",position:"relative","float":"left",lineHeight:"15px",color:"rgb(187, 109, 71)"}},React.createElement("span",null,v),React.createElement("br",null),React.createElement("span",null,"Δ ",h),React.createElement("br",null),React.createElement("span",null,y)),React.createElement("br",{style:{"float":"clear"}}),React.createElement("div",{style:{left:"0px",top:"5px",marginTop:"33px",fontWeight:"normal",lineHeight:"20px",color:"rgb(84, 114, 148)"}},"Integrated threshold: ",React.createElement("span",{style:{fontWeight:"bold"}},z),", range: ",React.createElement("span",{style:{fontWeight:"bold"}},f),e,React.createElement("span",{style:{"float":"right",padding:"0px 6px 3px 7px",border:"1px solid #888",color:"#888",marginTop:"2px",marginRight:"-12px",marginBottom:"0px",cursor:"pointer",width:"11px",textAlign:"center"},onClick:this.toogleBottomPanel},u))),m));
}});d.ButtonChooseAudioStatBlock=React.createClass({displayName:"ButtonChooseAudioStatBlock",btnClick:function(){this.props.onChooseAudioStatBlock(this.props.channel);
},render:function(){var f={border:"1px solid #222",padding:"3px 6px",marginRight:"2px",color:"#bba",cursor:"pointer"};
if(this.props.selected){f.border="1px solid #888";f.color="#eee";}var e=this.props.channel;
if(e!="Overall"){e++;e="Ch. "+e;}return(React.createElement("span",{onClick:this.btnClick,style:f},e));
}});d.ButtonSilenceGotoPlay=React.createClass({displayName:"ButtonSilenceGotoPlay",btnClick:function(){if(this.props.onGotoSilence){this.props.onGotoSilence(this.props.timevalue/1000);
}},render:function(){var f={fontWeight:"bold"};if(this.props.onGotoSilence){f.color="#bbb";
f.borderBottom="1px dotted #ccc";f.cursor="pointer";}var e=mydmam.format.msecToHMSms(this.props.timevalue);
return(React.createElement("span",{onClick:this.btnClick,style:f},e));}});})(window.mydmam.async.pathindex);
